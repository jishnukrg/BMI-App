pipeline {
  agent any

  stages {
    stage('Checkout') {
      steps {
        checkout scm
        echo "âœ… Code checked out successfully from test branch."
      }
    }

    stage('Build') {
      steps {
        echo 'ğŸ§± Compiling Java source files...'
        sh '''
          mkdir -p build
          javac -d build BMIApp.java
        '''
      }
    }

    stage('Test') {
      steps {
        echo 'ğŸ§ª Running simple verification...'
        sh 'echo âœ… BMIApp compiled successfully on test branch!'
      }
    }

    stage('Package') {
      steps {
        echo 'ğŸ“¦ Packaging into TAR artifact...'
        sh '''
          mkdir -p dist
          tar -cf dist/BMIApp-$BUILD_NUMBER.tar build
        '''
        echo "âœ… TAR file created successfully: dist/BMIApp-$BUILD_NUMBER.tar"
      }
    }

    stage('Release') {
      when { branch 'main' }
      steps {
        echo 'ğŸš€ Releasing build artifact for main branch only.'
      }
    }
  }

  post {
    success {
      echo "âœ… Pipeline succeeded â€” Build #$BUILD_NUMBER"
      echo "ğŸ§­ Branch-specific behavior confirmed: Release stage runs only on 'main'."
    }
    failure {
      echo "âŒ Pipeline failed â€” Check console log for details."
    }
  }
}
